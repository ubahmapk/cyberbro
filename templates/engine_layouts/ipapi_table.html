<td>
    {% if result.ipapi %}
    <strong>IP: </strong>{{ result.ipapi.ip }}<br />

    <div class="alert alert-warning">
        {% if result.ipapi.is_vpn %}<span class="badge badge-danger">VPN</span>{% endif %}
        {% if result.ipapi.is_tor %}<span class="badge badge-danger">TOR</span>{% endif %}
        {% if result.ipapi.is_proxy %}<span class="badge badge-danger">PROXY</span>{% endif %}
        {% if result.ipapi.is_abuser %}<span class="badge badge-danger">ABUSER</span>{% endif %}
    </div>

    {% if result.ipapi.location is defined and result.ipapi.location %}
    <strong>Location: </strong>
    {% if result.ipapi.location.city %}{{ result.ipapi.location.city }}{% endif %}
    {% if result.ipapi.location.city and result.ipapi.location.state %}, {% endif %}
    {% if result.ipapi.location.state %}{{ result.ipapi.location.state }}{% endif %}
    {% if not result.ipapi.location.city and not result.ipapi.location.state %}Unknown{% endif %}<br />
    <strong>Country: </strong>
    {% if result.ipapi.location.country %}
    <span class="country country-{{ result.ipapi.location.country | lower }}">{{ result.ipapi.location.country }}</span>
    {% if result.ipapi.location.country_code %}
    <span class="fi fi-{{ result.ipapi.location.country_code | lower }}"></span>
    {% endif %}
    {% else %}
    Unknown
    {% endif %}<br />
    {% else %}
    <strong>Location: </strong><span class="text-muted">Not available (possibly bogon/private IP)</span><br />
    <strong>Country: </strong><span class="text-muted">Not available</span><br />
    {% endif %}

    <strong>ASN: </strong>
    {% if result.ipapi.asn %}
    {{ result.ipapi.asn.asn if result.ipapi.asn.asn else 'Unknown' }}
    {{ result.ipapi.asn.org if result.ipapi.asn.org else '' }}
    {% else %}
    Unknown
    {% endif %}<br />
    {% if result.ipapi.is_vpn and result.ipapi.vpn and result.ipapi.vpn.url %}
    <strong>VPN Service: </strong><a href="{{ result.ipapi.vpn.url }}" target="_blank">{{
        result.ipapi.vpn.service }}</a><br />
    {% endif %}

    <style>
        .badge {
            display: inline-block;
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: bold;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            border-radius: 0.25rem;
            margin-right: 0.25rem;
        }

        .badge-danger {
            background-color: #dc3545;
            color: white;
        }
    </style>

    {% else %}
    Not applicable
    {% endif %}
</td>