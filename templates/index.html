<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icons/6.6.6/css/flag-icons.min.css">
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Include DataTables JS library -->
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <!-- Include colReorder extension -->
    <script src="https://cdn.datatables.net/colreorder/1.5.3/js/dataTables.colReorder.min.js"></script>
    <title>Cyberbro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <div class="container">
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">
            <img id="darkModeIcon" src="https://img.icons8.com/ios-filled/50/ffffff/moon-symbol.png" alt="Dark Mode"
                width="20" height="20">
        </button>

        <a href="https://github.com/stanfrbd/cyberbro" target="_blank" class="github-logo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" alt="GitHub Logo"
                width="40" height="40" class="github-logo-light">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" alt="GitHub Logo"
                width="40" height="40" class="github-logo-dark" style="filter: invert(1);">
        </a>
        <div id="startForm">
            {% include "form.html" %}
        </div>

        {% if analysis_results %}
        <script>
            function hideForm() {
                document.getElementById("startForm").style.display = "none";
            }
            hideForm();
        </script>

        <h1>Cyberbro - Analysis Results</h1>

        <button class="btn" onclick="location.href='/'">New Analysis</button>
        <div style="display: flex; gap: 10px; margin-left: 0;">
            <form method="GET" action="/export/{{ analysis_results.id }}"
                style="display: flex; gap: 10px; margin-left: 0;">
                <button type="submit" name="format" value="csv" class="btn">Export to CSV</button>
                <button type="submit" name="format" value="excel" class="btn">Export to Excel</button>
            </form>
            <button class="btn" onclick="location.href='/graph/{{ analysis_results.id }}'">Graph (experimental)</button>
            <button class="btn" onclick="location.href='/{{ API_PREFIX }}/results/{{ analysis_results.id }}'">Raw</button>
            <button class="btn" onclick="copyAsPlainText()">Copy as Plain Text</button>
            <button class="btn" onclick="copyAsDefanged()">Copy Defanged [.]</button>
        </div>

        <script>
            function fetchResults() {
    return fetch(`/{{ API_PREFIX }}/results/{{ analysis_results.id }}`)
        .then(response => response.json())
        .catch(err => {
            console.error('Failed to fetch results: ', err);
            throw err;
        });
}

function formatResults(data) {
    let plainText = '';
    data.forEach(result => {
        plainText += `Observable: ${result.observable}\nType: ${result.type}\n`;

        if (result.extension) {
            plainText += `Extension: ${result.extension.name}\n`;
            plainText += `URL: ${result.extension.url}\n`;
        }

        if (result.reverse_dns) {
            plainText += `Reverse DNS: ${result.reverse_dns.reverse_dns.join(', ')}\n`;
        }
        if (result.ipquery) {
            plainText += `IPquery: Geolocation: ${result.ipquery.geolocation}, Country: ${result.ipquery.country_name}, ASN: ${result.ipquery.asn} ${result.ipquery.isp}, Risk Score: ${result.ipquery.risk_score}, Proxy: ${result.ipquery.is_proxy}, Tor: ${result.ipquery.is_tor}, VPN: ${result.ipquery.is_vpn}\n`;
        }
        if (result.ipinfo) {
            plainText += `IPinfo: Geolocation: ${result.ipinfo.geolocation}, Country: ${result.ipinfo.country_name}, ASN: ${result.ipinfo.asn}\n`;
        }
        if (result.abuseipdb) {
            plainText += `AbuseIPDB: Reports: ${result.abuseipdb.reports}, Risk Score: ${result.abuseipdb.risk_score}\n`;
        }
        if (result.spur) {
            plainText += `Spur: Tunnels: ${result.spur.tunnels}\n`;
        }
        if (result.webscout) {
            plainText += `WebScout: `;
            if (result.webscout.risk_score) plainText += `Risk Score: ${result.webscout.risk_score}, `;
            if (result.webscout.is_vpn) {
                plainText += ` - VPN: ${result.webscout.is_vpn}\n`;
            }
            if (result.webscout.is_tor) {
                plainText += ` - Tor: ${result.webscout.is_tor}\n`;
            }
            if (result.webscout.is_proxy) {
                plainText += ` - Proxy: ${result.webscout.is_proxy}\n`;
            }
            if (result.webscout.country_name) plainText += `Country: ${result.webscout.country_name}, `;
            if (result.webscout.hostnames) plainText += `Hostnames: ${result.webscout.hostnames.join(', ')}, `;
            if (result.webscout.asn) plainText += `ASN: ${result.webscout.asn} ${result.webscout.as_org}\n`;
            if (result.webscout.description) plainText += ` - Description: ${result.webscout.description}\n`;
            if (result.webscout.domains_on_ip) plainText += ` - Domains on IP: ${result.webscout.domains_on_ip}\n`;
            if (result.webscout.network_type) plainText += ` - Type: ${result.webscout.network_type}\n`;
            if (result.webscout.network_service) plainText += ` - Network Service: ${result.webscout.network_service}\n`;
            if (result.webscout.network_service_region) plainText += ` - Network Service Region: ${result.webscout.network_service_region}\n`;
            if (result.webscout.network_provider_services.length > 0) plainText += ` - Services: ${result.webscout.network_provider_services.join(', ')}\n`;
            if (result.webscout.behavior) plainText += ` - Behavior: ${result.webscout.behavior.join(', ')}\n`;
            if (result.webscout.open_ports) plainText += ` - Open Ports: ${result.webscout.open_ports.join(', ')}\n`;
        }

        if (result.virustotal) {
            plainText += `VirusTotal: Detection Ratio: ${result.virustotal.detection_ratio}, Community Score: ${result.virustotal.community_score}\n`;
        }
        if (result.mde) {
            plainText += `Microsoft Defender for Endpoint: Prevalence: ${result.mde.organizationPrevalence}, First Seen: ${result.mde.orgFirstSeen}, Last Seen: ${result.mde.orgLastSeen}\n`;
        }
        if (result.google_safe_browsing) {
            plainText += `Google Safe Browsing: ${result.google_safe_browsing.threat_found}\n`;
        }
        if (result.shodan) {
            plainText += `Shodan: Ports: ${result.shodan.ports.join(', ')}${result.shodan.tags.length > 0 ? `, Tags: ${result.shodan.tags.join(', ')}` : ''}\n`;
        }
        if (result.phishtank) {
            plainText += `Phishtank: In Database: ${result.phishtank.in_database}\n`;
        }
        if (result.abusix) {
            plainText += `Abusix: ${result.abusix.abuse}\n`;
        }
        if (result.rdap) {
            if (result.rdap) {
                plainText += `RDAP:\n`;
                if (result.rdap.registrar) plainText += `- Registrar: ${result.rdap.registrar}\n`;
                if (result.rdap.abuse_contact) plainText += `- Abuse Contact: ${result.rdap.abuse_contact}\n`;
                if (result.rdap.registrant) plainText += `- Registrant: ${result.rdap.registrant}\n`;
                if (result.rdap.organization) plainText += `- Organization: ${result.rdap.organization}\n`;
                if (result.rdap.registrant_email) plainText += `- Registrant Email: ${result.rdap.registrant_email}\n`;
                if (result.rdap.creation_date) plainText += `- Creation Date: ${result.rdap.creation_date}\n`;
                if (result.rdap.expiration_date) plainText += `- Expiration Date: ${result.rdap.expiration_date}\n`;
                if (result.rdap.update_date) plainText += `- Updated Date: ${result.rdap.update_date}\n`;
                if (result.rdap.name_servers && result.rdap.name_servers.length > 0) {
                    plainText += `- Name Servers: ${result.rdap.name_servers.join(', ')}\n`;
                }
            }
        }
        if (result.threatfox && result.threatfox.count > 0) {
            plainText += `ThreatFox: Count: ${result.threatfox.count}, Malware: ${result.threatfox.malware_printable.join(', ')}\n`;
        }
        if (result.google && result.google.results.length > 0) {
            plainText += `Google:\n`;
            result.google.results.forEach(googleResult => {
                plainText += `  - ${googleResult.title}: ${googleResult.url}\n`;
            });
        }
        if (result.github && result.github.results.length > 0) {
            plainText += `Github:\n`;
            result.github.results.forEach(githubResult => {
                plainText += `  - ${githubResult.title}: ${githubResult.url}\n`;
            });
        }
        if (result.ioc_one_html && result.ioc_one_html.results.length > 0) {
            plainText += `Ioc.One (HTML):\n`;
            result.ioc_one_html.results.forEach(iocOneHtmlResult => {
                plainText += `  - ${iocOneHtmlResult.title}: ${iocOneHtmlResult.source}\n`;
            });
        }
        if (result.ioc_one_pdf && result.ioc_one_pdf.results.length > 0) {
            plainText += `Ioc.One (PDF):\n`;
            result.ioc_one_pdf.results.forEach(iocOnePdfResult => {
                plainText += `  - ${iocOnePdfResult.title}: ${iocOnePdfResult.source}\n`;
            });
        }
        if (result.urlscan && result.urlscan.scan_count > 0) {
            plainText += `URLscan: Scan Count: ${result.urlscan.scan_count}\n`;
            result.urlscan.top_domains.forEach(domain => {
                plainText += `  - ${domain.domain} (${domain.count})\n`;
            });
        }
        if (result.opencti && result.opencti.global_count > 0) {
            plainText += `OpenCTI:\n`;
            plainText += `  - Global Count: ${result.opencti.global_count}\n`;
            plainText += `  - Entity Counts:\n`;
            for (const [entity, count] of Object.entries(result.opencti.entity_counts)) {
                plainText += `    - ${entity}: ${count}\n`;
            }
            plainText += `  - Search Link: ${result.opencti.search_link}\n`;
            plainText += `  - Latest Entity Created At: ${result.opencti.latest_created_at}\n`;
            plainText += `  - Latest Indicator Name: ${result.opencti.latest_indicator_name}\n`;
            if (result.opencti.latest_indicator_link) {
                plainText += `  - Latest Indicator Link: ${result.opencti.latest_indicator_link}\n`;
                plainText += `  - OpenCTI Score: ${result.opencti.x_opencti_score} / 100\n`;
                plainText += `  - Confidence: ${result.opencti.confidence}\n`;
                plainText += `  - Revoked: ${result.opencti.revoked}\n`;
                plainText += `  - Valid From: ${result.opencti.valid_from}\n`;
                plainText += `  - Valid Until: ${result.opencti.valid_until}\n`;
            }
        }

        if (result.criminalip) {
            plainText += `Criminal IP:\n`;
            plainText += `  - Abuse Record Count: ${result.criminalip.abuse_record_count}\n`;
            if (result.criminalip.score) {
                plainText += `  - Score:\n`;
                plainText += `    - Inbound: ${result.criminalip.score.inbound}\n`;
                plainText += `    - Outbound: ${result.criminalip.score.outbound}\n`;
            }
            if (result.criminalip.current_open_port && result.criminalip.current_open_port.count > 0) {
                plainText += `  - Current Open Ports:\n`;
                result.criminalip.current_open_port.forEach(port => {
                    plainText += `    - ${port}\n`;
                });
            }
            if (result.criminalip.issues) {
                for (const [issue_name, value] of Object.entries(result.criminalip.issues)) {
                    plainText += `    - ${issue_name}: ${value}\n`;
                }
            }
            if (result.criminalip.represenative_domain) {
                plainText += `  - Representative Domain: ${result.criminalip.represenative_domain}\n`;
            }
        }

        if (result.alienvault) {
            plainText += `Alienvault:\n`;
            plainText += `  - Pulse Count: ${result.alienvault.count}\n`;
            if (result.alienvault.count > 0) {
            result.alienvault.pulses.forEach(alienvaultPulse => {
                plainText += `  - ${alienvaultPulse.title}: ${alienvaultPulse.url}\n`;
            });
            }
            if (result.alienvault.malware_families.length > 0) {
                plainText += `  - Malware Families: ${result.alienvault.malware_families.join(', ')}\n`;
            }
            if (result.alienvault.adversary.length > 0) {
                plainText += `  - Adversary: ${result.alienvault.adversary.join(', ')}\n`;
            }

        }

        if (result.hudsonrock) {
            plainText += `Hudson Rock:\n`;

            if (result.type === "Email" && result.hudsonrock.stealers) {
                plainText += `Compromised Computer Details:\n`;
                result.hudsonrock.stealers.forEach(stealer => {
                    if (stealer.computer_name) plainText += `Computer Name: ${stealer.computer_name}\n`;
                    if (stealer.operating_system) plainText += `Operating System: ${stealer.operating_system}\n`;
                    if (stealer.date_compromised) plainText += `Date Compromised: ${stealer.date_compromised}\n`;
                    if (stealer.total_corporate_services) plainText += `Total Corporate Services: ${stealer.total_corporate_services}\n`;
                    if (stealer.total_user_services) plainText += `Total User Services: ${stealer.total_user_services}\n`;
                });
            } else if (result.type === "URL" || result.type === "FQDN") {
                plainText += `Compromised domain details:\n`;
                if (result.hudsonrock.total) plainText += `Total: ${result.hudsonrock.total}\n`;
                if (result.hudsonrock.totalStealers) plainText += `Total Stealers: ${result.hudsonrock.totalStealers}\n`;
                if (result.hudsonrock.employees) plainText += `Employees: ${result.hudsonrock.employees}\n`;
                if (result.hudsonrock.users) plainText += `Users: ${result.hudsonrock.users}\n`;
                if (result.hudsonrock.third_parties) plainText += `Third Parties: ${result.hudsonrock.third_parties}\n`;
                if (result.hudsonrock.totalUrls) plainText += `Total URLs: ${result.hudsonrock.totalUrls}\n`;
                if (result.hudsonrock.last_employee_compromised) plainText += `Last Employee Compromised: ${result.hudsonrock.last_employee_compromised.split('T')[0]}\n`;
                if (result.hudsonrock.last_user_compromised) plainText += `Last User Compromised: ${result.hudsonrock.last_user_compromised.split('T')[0]}\n`;
                if (result.hudsonrock.is_shopify) plainText += `Is Shopify: ${result.hudsonrock.is_shopify}\n`;
                if (result.hudsonrock.applications) plainText += `Applications: ${result.hudsonrock.applications.map(app => app.keyword).join(', ')}\n`;
                if (result.hudsonrock.stealerFamilies) {
                    plainText += `Stealer Families:\n`;
                    for (const [family, count] of Object.entries(result.hudsonrock.stealerFamilies)) {
                        plainText += `  - ${family}: ${count}\n`;
                    }
                }
                if (result.hudsonrock.stats.employees_urls) {
                    plainText += `Employee URLs:\n`;
                    result.hudsonrock.stats.employees_urls.forEach(url => {
                        if (!url.includes("••")) plainText += `  - ${url}\n`;
                    });
                }
                if (result.hudsonrock.stats.clients_urls) {
                    plainText += `Client URLs:\n`;
                    result.hudsonrock.stats.clients_urls.forEach(url => {
                        if (!url.includes("••")) plainText += `  - ${url}\n`;
                    });
                }
            }
        }

        if (result.crowdstrike) {
            plainText += `CrowdStrike:\n`;
            plainText += `  - Device Count: ${result.crowdstrike.device_count}\n`;
            if (result.crowdstrike.indicator_found) {
                plainText += `  - Published Date: ${result.crowdstrike.published_date}\n`;
                plainText += `  - Last Updated: ${result.crowdstrike.last_updated}\n`;
                if (result.crowdstrike.actors.length > 0) {
                    plainText += `  - Actors: ${result.crowdstrike.actors.join(', ')}\n`;
                }
                if (result.crowdstrike.malicious_confidence) {
                    plainText += `  - Malicious Confidence: ${result.crowdstrike.malicious_confidence}\n`;
                }
                if (result.crowdstrike.threat_types.length > 0) {
                    plainText += `  - Threat Types: ${result.crowdstrike.threat_types.join(', ')}\n`;
                }
                if (result.crowdstrike.malware_families.length > 0) {
                    plainText += `  - Malware Families: ${result.crowdstrike.malware_families.join(', ')}\n`;
                }
                if (result.crowdstrike.kill_chain.length > 0) {
                    plainText += `  - Kill Chain: ${result.crowdstrike.kill_chain.join(', ')}\n`;
                }
                if (result.crowdstrike.vulnerabilities.length > 0) {
                    plainText += `  - Vulnerabilities: ${result.crowdstrike.vulnerabilities.join(', ')}\n`;
                }
            }
        }
        plainText += '\n';
    });

    return plainText
}

function copyAsPlainText() {
    fetchResults()
        .then(data => {
            const plainText = formatResults(data);
            return navigator.clipboard.writeText(plainText);
        })
        .then(() => {
            const copyButton = document.querySelector('.btn[onclick="copyAsPlainText()"]');
            const initialBackgroundColor = copyButton.style.backgroundColor;
            const initialTextContent = copyButton.textContent;

            copyButton.style.backgroundColor = 'green';
            copyButton.textContent = 'Copied!';

            setTimeout(() => {
                copyButton.style.backgroundColor = initialBackgroundColor;
                copyButton.textContent = initialTextContent;
            }, 1000);
        })
        .catch(err => {
            console.error('Failed to copy text: ', err);
        });
}

function formatDefanged(plainText) {
    return plainText
        .replace(/\./g, '[.]')
        .replace(/@/g, '[@]')
        .replace(/:\/\//g, '[://]');
}

function copyAsDefanged() {
    fetchResults()
        .then(data => {
            const plainText = formatResults(data);
            const defangedText = formatDefanged(plainText);
            return navigator.clipboard.writeText(defangedText);
        })
        .then(() => {
            const copyButton = document.querySelector('.btn[onclick="copyAsDefanged()"]');
            const initialBackgroundColor = copyButton.style.backgroundColor;
            const initialTextContent = copyButton.textContent;

            copyButton.style.backgroundColor = 'green';
            copyButton.textContent = 'Defanged and Copied!';

            setTimeout(() => {
                copyButton.style.backgroundColor = initialBackgroundColor;
                copyButton.textContent = initialTextContent;
            }, 1000);
        })
        .catch(err => {
            console.error('Failed to copy defanged text: ', err);
        });
}
        </script>

        <p>Analysis start time: {{ analysis_results.start_time_string }}</p>
        <p>Analysis duration: {{ analysis_results.analysis_duration_string }}</p>

        {% if display_mode == "table" or analysis_results.results | length > 1 %}

        <div class="filters-container">
            <input type="text" id="searchInput" class="filter-input" onkeyup="filterTable()" placeholder="Search...">

            <select id="typeFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All observables types</option>
                {% set types = [] %}
                {% for result in analysis_results.results %}
                {% if result.type not in types %}
                {% set _ = types.append(result.type) %}
                <option value="{{ result.type }}">{{ result.type }}</option>
                {% endif %}
                {% endfor %}
            </select>

            <select id="countryFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All Countries</option>
                {% set countries = [] %}
                {% for result in analysis_results.results %}
                {% if (result.ipinfo and result.ipinfo.country_name not in countries) or (result.ipquery and result.ipquery.country_name not in countries) or (result.webscout and result.webscout.country_name not in countries) %}
                {% if result.ipinfo and result.ipinfo.country_name not in countries %}
                {% set _ = countries.append(result.ipinfo.country_name) %}
                <option value="{{ result.ipinfo.country_name | lower }}">{{ result.ipinfo.country_name }}</option>
                {% endif %}
                {% if result.ipquery and result.ipquery.country_name not in countries %}
                {% set _ = countries.append(result.ipquery.country_name) %}
                <option value="{{ result.ipquery.country_name | lower }}">{{ result.ipquery.country_name }}</option>
                {% endif %}
                {% if result.webscout and result.webscout.country_name not in countries %}
                {% set _ = countries.append(result.webscout.country_name) %}
                <option value="{{ result.webscout.country_name | lower }}">{{ result.webscout.country_name }}</option>
                {% endif %}
                {% endif %}
                {% endfor %}
            </select>

            <select id="riskFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All Risks</option>
                <option value="high">High Risk</option>
                <option value="low">Low Risk</option>
            </select>

            <select id="detectionFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All Detections</option>
                <option value="high">High Detection</option>
                <option value="clean">Clean Detection</option>
            </select>

            <select id="proxyVpnFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All connection info</option>
                <option value="proxy">Proxy</option>
                <option value="vpn">VPN</option>
                <option value="not anonymous">Not anonymous</option>
            </select>

            <button class="btn" onclick="clearFilters()">Clear Filters</button>
        </div>

        <table id="resultsTable">
            <thead>
                <tr>
                    <th>Observable</th>
                    <th>Type</th>
                    {% if "reverse_dns" in analysis_results.selected_engines %}
                    <th>DNS Lookup</th>
                    {% endif %}
                    {% if "CHROME_EXTENSION" in analysis_results.results | map(attribute='type') %}
                    <th>Extension</th>
                    {% endif %}
                    {% if "ipquery" in analysis_results.selected_engines %}
                    <th>IPquery</th>
                    {% endif %}
                    {% if "ipinfo" in analysis_results.selected_engines %}
                    <th>IPinfo</th>
                    {% endif %}
                    {% if "abuseipdb" in analysis_results.selected_engines %}
                    <th>AbuseIPDB</th>
                    {% endif %}
                    {% if "spur" in analysis_results.selected_engines %}
                    <th>Spur.us</th>
                    {% endif %}
                    {% if "virustotal" in analysis_results.selected_engines %}
                    <th>VirusTotal</th>
                    {% endif %}
                    {% if "mde" in analysis_results.selected_engines %}
                    <th>Microsoft Defender for Endpoint</th>
                    {% endif %}
                    {% if "google_safe_browsing" in analysis_results.selected_engines %}
                    <th>Google Safe Browsing</th>
                    {% endif %}
                    {% if "shodan" in analysis_results.selected_engines %}
                    <th>Shodan</th>
                    {% endif %}
                    {% if "phishtank" in analysis_results.selected_engines %}
                    <th>Phishtank</th>
                    {% endif %}
                    {% if "abusix" in analysis_results.selected_engines %}
                    <th>Abusix</th>
                    {% endif %}
                    {% if "rdap" in analysis_results.selected_engines %}
                    <th>RDAP</th>
                    {% endif %}
                    {% if "threatfox" in analysis_results.selected_engines %}
                    <th>ThreatFox</th>
                    {% endif %}
                    {% if "google" in analysis_results.selected_engines %}
                    <th>Google</th>
                    {% endif %}
                    {% if "github" in analysis_results.selected_engines %}
                    <th>Github</th>
                    {% endif %}
                    {% if "ioc_one_html" in analysis_results.selected_engines %}
                    <th>Ioc.One (HTML)</th>
                    {% endif %}
                    {% if "ioc_one_pdf" in analysis_results.selected_engines %}
                    <th>Ioc.One (PDF)</th>
                    {% endif %}
                    {% if "urlscan" in analysis_results.selected_engines %}
                    <th>URLscan</th>
                    {% endif %}
                    {% if "opencti" in analysis_results.selected_engines %}
                    <th>OpenCTI</th>
                    {% endif %}
                    {% if "hudsonrock" in analysis_results.selected_engines %}
                    <th>Hudson Rock</th>
                    {% endif %}
                    {% if "crowdstrike" in analysis_results.selected_engines %}
                    <th>CrowdStrike</th>
                    {% endif %}
                    {% if "webscout" in analysis_results.selected_engines %}
                    <th>WebScout</th>
                    {% endif %}
                    {% if "criminalip" in analysis_results.selected_engines %}
                    <th>Criminal IP</th>
                    {% endif %}
                    {% if "alienvault" in analysis_results.selected_engines %}
                    <th>Alienvault</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for result in analysis_results.results %}
                <tr class="
                    {% if result.abuseipdb and result.abuseipdb.risk_score > 50 %}
                        high-risk
                    {% elif result.virustotal and (result.virustotal.total_malicious > 10 or result.virustotal.community_score < -10) %}
                        high-detection high-risk
                    {% elif result.spur and result.spur.tunnels not in ['Not anonymous', 'Non applicable'] %}
                        warning-row
                    {% elif result.ipquery and (result.ipquery.is_proxy or result.ipquery.is_vpn or result.ipquery.is_tor) %}
                        warning-row
                    {% elif result.ipquery and result.ipquery.risk_score > 50 %}
                        high-risk
                    {% elif result.threatfox and result.threatfox.count != 0 %}
                        high-risk
                    {% elif result.opencti and result.opencti.latest_indicator_link and not result.opencti.revoked %}
                        warning-row
                    {% elif result.crowdstrike and result.crowdstrike.indicator_found and result.crowdstrike.malicious_confidence == 'high' %}
                        high-risk
                    {% elif result.webscout and 'vpn' in result.webscout.network_provider_services | map('lower') or result.webscout and 'proxy' in result.webscout.network_provider_services | map('lower') or result.webscout and result.webscout.is_proxy or result.webscout and result.webscout.is_tor or result.webscout and result.webscout.is_vpn %}
                        warning-row
                    {% elif result.webscout and result.webscout.risk_score > 50 %}
                        high-risk
                    {% elif result.virustotal and result.virustotal.community_score > 100 %}
                        clean-detection
                    {% endif %}
                    ">
                    <td title="{{ result.observable }}">{{ result.observable[:64] }}{% if result.observable | length >
                        64 %}...{% endif %}</td>
                    <td>{{ result.type }}</td>
                    {% if "reverse_dns" in analysis_results.selected_engines %}
                    <td>
                        {% if result.reverse_dns %}
                        {% for dns in result.reverse_dns.reverse_dns %}
                        {{ dns }}<br>
                        {% endfor %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "CHROME_EXTENSION" in analysis_results.results | map(attribute='type') %}
                    <td>
                        {% if result.type == "CHROME_EXTENSION" %}
                        <a href="{{ result.extension.url }}" target="_blank">{{ result.extension.name }}</a>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ipquery" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ipquery %}
                        <strong>IP: </strong><a href="{{ result.ipquery.link }}" target="_blank">{{ result.ipquery.ip
                            }}</a><br>
                        <strong>Score: </strong><a href="{{ result.ipquery.link }}" target="_blank">{{
                            result.ipquery.risk_score }}</a><br>

                        <strong>Geoloc: </strong>{{ result.ipquery.geolocation }}<br>
                        <strong>Country: </strong><span
                            class="country country-{{result.ipquery.country_name | lower}}">{{result.ipquery.country_name}}</span>
                        <span class="fi fi-{{ result.ipquery.country_code | lower }}"></span><br>
                        <strong>ASN: </strong>{{ result.ipquery.asn }} {{ result.ipquery.isp }}<br>
                        {% if result.ipquery.is_proxy == True %}
                        <strong>Proxy: </strong>{{ result.ipquery.is_proxy }}<br>
                        {% endif %}

                        {% if result.ipquery.is_vpn == True %}
                        <strong>VPN: </strong>{{ result.ipquery.is_vpn }}<br>
                        {% endif %}
                        {% if result.ipquery.is_tor == True %}
                        <strong>Tor: </strong>{{ result.ipquery.is_tor }}<br>
                        {% endif %}
                        {% if result.ipquery.is_tor == False and result.ipquery.is_vpn == False and
                        result.ipquery.is_proxy == False %}
                        <strong>Type: </strong>Not anonymous<br>
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ipinfo" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ipinfo and result.reversed_success and result.type in ["URL", "FQDN"] %}
                        Reverse DNS applied<br>
                        {% endif %}
                        {% if result.ipinfo %}
                        <strong>IP: </strong><a href="{{ result.ipinfo.link }}" target="_blank">{{ result.ipinfo.ip
                            }}</a><br>
                        <strong>Geoloc: </strong>{{ result.ipinfo.geolocation }}<br>
                        <strong>Country: </strong><span
                            class="country country-{{result.ipinfo.country_name | lower}}">{{result.ipinfo.country_name}}</span>
                        <span class="fi fi-{{ result.ipinfo.country_code | lower }}"></span><br>
                        <strong>Hostname: </strong>{{ result.ipinfo.hostname }}<br>
                        <strong>ASN: </strong>{{ result.ipinfo.asn }}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "abuseipdb" in analysis_results.selected_engines %}
                    <td>
                        {% if result.abuseipdb and result.reversed_success and result.type in ["URL", "FQDN"] %}
                        Reverse DNS applied<br>
                        {% endif %}
                        {% if result.abuseipdb %}
                        <strong>Reports: </strong>
                        <a href="{{ result.abuseipdb.link }}" target="_blank">{{ result.abuseipdb.reports }}</a><br>
                        <strong>Risk: </strong>{{ result.abuseipdb.risk_score }}%<br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "spur" in analysis_results.selected_engines %}
                    <td>
                        {% if result.spur and result.reversed_success and result.type in ["URL", "FQDN"] %}
                        Reverse DNS applied<br>
                        {% endif %}
                        {% if result.spur %}
                        <a href="{{ result.spur.link }}" target="_blank">{{ result.spur.tunnels }}</a><br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "virustotal" in analysis_results.selected_engines %}
                    <td>
                        {% if result.virustotal %}
                        <strong>Ratio: </strong>
                        <a href="{{ result.virustotal.link }}" target="_blank">{{ result.virustotal.detection_ratio
                            }}</a><br>
                        <strong>Community: </strong>{{ result.virustotal.community_score }}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "mde" in analysis_results.selected_engines %}
                    <td>
                        {% if result.mde and result.mde.ipAddress %}
                        <strong>Devices: </strong><a href="{{ result.mde.link }}" target="_blank">{{
                            result.mde.orgPrevalence }}</a><br>
                        <strong>First seen: </strong>{{ result.mde.orgFirstSeen }} <br>
                        <strong>Last seen: </strong>{{ result.mde.orgLastSeen }} <br>
                        {% elif result.mde and result.mde.sha1 %}
                        <strong>Devices: </strong><a href="{{ result.mde.link }}" target="_blank">{{
                            result.mde.organizationPrevalence }}</a><br>
                        <strong>First seen: </strong>{{ result.mde.orgFirstSeen }} <br>
                        <strong>Last seen: </strong>{{ result.mde.orgLastSeen }} <br>
                        <strong>Top filenames: </strong>{{ result.mde.topFileNames }} <br>
                        <strong>File product name: </strong>{{ result.mde.fileProductName }} <br>
                        <strong>File publisher: </strong>{{ result.mde.filePublisher }} <br>
                        <strong>Signer : </strong>{{ result.mde.signer }} <br>
                        <strong>Issuer: </strong>{{ result.mde.issuer }} <br>
                        <strong>IsValidCertificate: </strong>{{ result.mde.isValidCertificate }} <br>
                        <strong>Determination: </strong>{{ result.mde.determinationType }} <br>
                        <strong>Determination value: </strong>{{ result.mde.determinationValue }}
                        {% elif result.mde and result.mde.host %}
                        </strong>Devices: </strong><a href="{{ result.mde.link }}" target="_blank">{{
                            result.mde.orgPrevalence }}</a><br>
                        </strong>First seen: </strong>{{ result.mde.orgFirstSeen }} <br>
                        </strong>Last seen: </strong>{{ result.mde.orgLastSeen }} <br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "google_safe_browsing" in analysis_results.selected_engines %}
                    <td>
                        {% if result.google_safe_browsing %}
                        <strong>Threat: </strong>{{ result.google_safe_browsing.threat_found }} <br>
                        <strong>Details: </strong>{{ result.google_safe_browsing.details }}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "shodan" in analysis_results.selected_engines %}
                    <td>
                        {% if result.shodan %}
                        <strong>Ports:</strong><br>
                        <a href="{{ result.shodan.link }}" target="_blank">
                            {% for port in result.shodan.ports %}
                            {{ port }}<br>
                            {% endfor %}
                        </a>
                        {% if result.shodan.tags | length > 0 %}
                        <strong>Tags: </strong>
                        {% for tag in result.shodan.tags %}
                        {{ tag | upper }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "phishtank" in analysis_results.selected_engines %}
                    <td>
                        {% if result.phishtank and result.phishtank.in_database == True and result.phishtank.valid ==
                        True and result.phishtank.verified == True %}
                        <a href="{{ result.phishtank.phish_detail_page }}" target="_blank">Found (valid and
                            verified)</a>
                        {% elif result.phishtank and result.phishtank.in_database == True and result.phishtank.valid ==
                        False %}
                        <a href="{{ result.phishtank.phish_detail_page }}" target="_blank">Found (invalid)</a>
                        {% elif result.phishtank and result.phishtank.in_database == True and result.phishtank.verified
                        == False %}
                        <a href="{{ result.phishtank.phish_detail_page }}" target="_blank">Found (not verified)</a>
                        {% elif result.phishtank and result.phishtank.in_database == False %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "abusix" in analysis_results.selected_engines %}
                    <td>
                        {% if result.abusix %}
                        <strong>Abuse contact: </strong><a
                            href="mailto:{{ result.abusix.abuse }}?subject=Report of abuse concerning {{ result.observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ result.type }} {{ result.observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{
                            result.abusix.abuse }}</a>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "rdap" in analysis_results.selected_engines %}
                    <td>
                        {% if result.rdap %}
                        <strong>Registrar: </strong><a href="{{ result.rdap.link }}" target="_blank">{{
                            result.rdap.registrar }}</a><br>
                        {% if result.rdap.abuse_contact and result.rdap.abuse_contact != "" %}
                        <strong>Abuse contact: </strong><a
                            href="mailto:{{ result.rdap.abuse_contact }}?subject=Report of abuse concerning {{ result.observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ result.type }} {{ result.observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{
                            result.rdap.abuse_contact }}</a><br>
                        {% endif %}
                        {% if result.rdap.registrant and result.rdap.registrant != "" %}
                        <strong>Registrant: </strong> {{ result.rdap.registrant }}<br>
                        {% endif %}
                        {% if result.rdap.organization and result.rdap.organization != "" %}
                        <strong>Organization: </strong>{{ result.rdap.organization }}<br>
                        {% endif %}
                        {% if result.rdap.registrant_email and result.rdap.registrant_email != "" %}
                        <strong>Registrant email: </strong><a
                            href="mailto:{{ result.rdap.registrant_email }}?subject=Report of abuse concerning {{ result.observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ result.type }} {{ result.observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{
                            result.rdap.registrant_email }}</a><br>
                        {% endif %}
                        <strong>Creation: </strong>{{ result.rdap.creation_date }}<br>
                        <strong>Expiration: </strong>{{ result.rdap.expiration_date }}<br>
                        <strong>Updated: </strong>{{ result.rdap.update_date }}<br>
                        <strong>Name servers: </strong><br>
                        {% for ns in result.rdap.name_servers %}
                        {{ ns }}<br>
                        {% endfor %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "threatfox" in analysis_results.selected_engines %}
                    <td>
                        {% if result.threatfox and result.threatfox.count != 0 %}
                        <strong>Count: </strong><a href="{{ result.threatfox.link }}" target="_blank"
                            title="Might not be available in the website itself.">{{ result.threatfox.count }}</a><br>
                        <strong>Malware: </strong><br>
                        {% for malware in result.threatfox.malware_printable %}
                        {{ malware }}<br>
                        {% endfor %}
                        {% elif result.threatfox and result.threatfox.count == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "google" in analysis_results.selected_engines %}
                    <td>
                        {% if result.google and result.google.results | length > 0 %}
                        <strong>Search results: </strong><br>
                        {% for search_result in result.google.results %}
                        <a href="{{ search_result.url }}" target="_blank" title="{{ search_result.description }}">{{
                            search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.google and result.google.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "github" in analysis_results.selected_engines %}
                    <td>
                        {% if result.github and result.github.results | length > 0 %}
                        <strong>Search results: </strong><br>
                        {% for search_result in result.github.results %}
                        <a href="{{ search_result.url }}" target="_blank" title="{{ search_result.description }}">{{
                            search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.github and result.github.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ioc_one_html" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ioc_one_html and result.ioc_one_html.results | length > 0 %}
                        <strong>Search results: </strong><a href="{{ result.ioc_one_html.link }}" target="_blank">See on
                            Ioc.One</a><br>
                        ---<br>
                        {% for search_result in result.ioc_one_html.results %}
                        <a href="{{ search_result.source }}" target="_blank" title="{{ search_result.header }}">{{
                            search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.ioc_one_html and result.ioc_one_html.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ioc_one_pdf" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ioc_one_pdf and result.ioc_one_pdf.results | length > 0 %}
                        <strong>Search results: </strong><a href="{{ result.ioc_one_pdf.link }}" target="_blank">See on
                            Ioc.One</a><br>
                        ---<br>
                        {% for search_result in result.ioc_one_pdf.results %}
                        <a href="{{ search_result.source }}" target="_blank" title="{{ search_result.header }}">{{
                            search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.ioc_one_pdf and result.ioc_one_pdf.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "urlscan" in analysis_results.selected_engines %}
                    <td>
                        {% if result.urlscan %}
                        <strong>Scan count: </strong><a href="{{ result.urlscan.link }}" target="_blank">{{
                            result.urlscan.scan_count }}</a><br>
                        {% if result.urlscan.scan_count == 0 %}
                        Not Found
                        {% else %}
                        <strong>
                            {% if result.type in ["FQDN", "URL"] %}
                            Top domains:
                            {% else %}
                            Top related domains:
                            {% endif %}
                        </strong>
                        <ul>
                            {% for domain in result.urlscan.top_domains %}
                            <li>{{ domain.domain }} ({{ domain.count }})</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "opencti" in analysis_results.selected_engines %}
                    <td>
                        {% if result.opencti %}
                        <strong>Global count: </strong>{{ result.opencti.global_count }}<br>
                        <strong>Entity counts:</strong>
                        <ul>
                            {% for entity, count in result.opencti.entity_counts.items() %}
                            <li>{{ entity }}: {{ count }}</li>
                            {% endfor %}
                        </ul>
                        <strong>Search link: </strong><a href="{{ result.opencti.search_link }}" target="_blank">See on OpenCTI</a><br>
                        <strong>Latest Entity Created At: </strong>{{ result.opencti.latest_created_at }}<br>
                        {% if result.opencti.latest_indicator_link %}
                            <strong>Latest Indicator Name: </strong>{{ result.opencti.latest_indicator_name }}<br>
                            <strong>Latest Indicator Link: </strong><a href="{{ result.opencti.latest_indicator_link }}" target="_blank">See Indicator</a><br>
                            <strong>OpenCTI Score: </strong>{{ result.opencti.x_opencti_score }} / 100<br>
                            <strong>Confidence: </strong>{{ result.opencti.confidence }}<br>
                            <strong>Revoked: </strong>{{ result.opencti.revoked }}<br>
                            <strong>Valid From: </strong>{{ result.opencti.valid_from }}<br>
                            <strong>Valid Until: </strong>{{ result.opencti.valid_until }}<br>
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "hudsonrock" in analysis_results.selected_engines %}
                    <td>
                        {% if result.type == "Email" and result.hudsonrock and result.hudsonrock.stealers %}
                        <strong>Compromised Computer Details:</strong><br>
                        {% for stealer in result.hudsonrock.stealers %}
                        {% if stealer.computer_name %}<strong>Computer Name: </strong>{{ stealer.computer_name }}<br>{% endif %}
                        {% if stealer.operating_system %}<strong>Operating System: </strong>{{ stealer.operating_system }}<br>{% endif %}
                        {% if stealer.date_compromised %}<strong>Date Compromised: </strong>{{ stealer.date_compromised }}<br>{% endif %}
                        {% if stealer.total_corporate_services %}<strong>Total Corporate Services: </strong>{{ stealer.total_corporate_services }}<br>{% endif %}
                        {% if stealer.total_user_services %}<strong>Total User Services: </strong>{{ stealer.total_user_services }}<br>{% endif %}
                        {% endfor %}
                        {% elif result.hudsonrock and (result.type == "URL" or result.type == "FQDN") and result.hudsonrock.total %}
                        <strong>Compromised domain details</strong>
                        {% if result.hudsonrock.total %}<p><strong>Total: </strong>{{ result.hudsonrock.total }}</p>{% endif %}
                        {% if result.hudsonrock.total and result.hudsonrock.totalStealers %}<p><strong>Total Stealers: </strong>{{ result.hudsonrock.totalStealers }}</p>{% endif %}
                        {% if result.hudsonrock.employees %}<p><strong>Employees: </strong>{{ result.hudsonrock.employees }}</p>{% endif %}
                        {% if result.hudsonrock.users %}<p><strong>Users: </strong>{{ result.hudsonrock.users }}</p>{% endif %}
                        {% if result.hudsonrock.third_parties %}<p><strong>Third Parties: </strong>{{ result.hudsonrock.third_parties }}</p>{% endif %}
                        {% if result.hudsonrock.totalUrls %}<p><strong>Total URLs: </strong>{{ result.hudsonrock.totalUrls }}</p>{% endif %}
                        {% if result.hudsonrock.last_employee_compromised %}<p><strong>Last Employee Compromised: </strong>{{ result.hudsonrock.last_employee_compromised.split('T')[0] }}</p>{% endif %}
                        {% if result.hudsonrock.last_user_compromised %}<p><strong>Last User Compromised: </strong>{{ result.hudsonrock.last_user_compromised.split('T')[0] }}</p>{% endif %}
                        {% if result.hudsonrock.is_shopify %}<p><strong>Is Shopify: </strong>{{ result.hudsonrock.is_shopify }}</p>{% endif %}
                        {% if result.hudsonrock.applications %}<p><strong>Applications: </strong>{{ result.hudsonrock.applications | map(attribute='keyword') | join(', ') }}</p>{% endif %}
                        {% if result.hudsonrock.stealerFamilies %}
                        <p><strong>Stealer Families: </strong></p>
                        <ul>
                            {% for family, count in result.hudsonrock.stealerFamilies.items() %}
                            <li>{{ family }}: {{ count }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                        {% if result.hudsonrock.stats.employees_urls %}
                        <p><strong>Employee URLs: </strong></p>
                        <ul>
                            {% for url in result.hudsonrock.stats.employees_urls %}
                            {% if "••" not in url %}
                            <li><a href="{{ url }}" target="_blank">{{ url }}</a></li>
                            {% endif %}
                            {% endfor %}
                        </ul>
                        {% endif %}
                        {% if result.hudsonrock.stats.clients_urls %}
                        <p><strong>Client URLs: </strong></p>
                        <ul>
                            {% for url in result.hudsonrock.stats.clients_urls %}
                            {% if "••" not in url %}
                            <li><a href="{{ url }}" target="_blank">{{ url }}</a></li>
                            {% endif %}
                            {% endfor %}
                        </ul>
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "crowdstrike" in analysis_results.selected_engines %}
                    <td>
                        {% if result.crowdstrike %}
                        <strong>Device Count: </strong>{{ result.crowdstrike.device_count }}<br>
                        <strong>Link: </strong><a href="{{ result.crowdstrike.link }}" target="_blank">See on CrowdStrike</a><br>
                        {% if result.crowdstrike.indicator_found %}
                            <strong>Published Date: </strong>{{ result.crowdstrike.published_date }}<br>
                            <strong>Last Updated: </strong>{{ result.crowdstrike.last_updated }}<br>
                            {% if result.crowdstrike.actors %}
                                <strong>Actors: </strong>{{ result.crowdstrike.actors | join(', ') }}<br>
                            {% endif %}
                            {% if result.crowdstrike.malicious_confidence %}
                                <strong>Malicious Confidence: </strong>{{ result.crowdstrike.malicious_confidence }}<br>
                            {% endif %}
                            {% if result.crowdstrike.threat_types %}
                                <strong>Threat Types: </strong>{{ result.crowdstrike.threat_types | join(', ') }}<br>
                            {% endif %}
                            {% if result.crowdstrike.malware_families %}
                            <strong>Malware Families: </strong>{{ result.crowdstrike.malware_families | join(', ') }}<br>
                            {% endif %}
                            {% if result.crowdstrike.kill_chain %}
                                <strong>Kill Chain: </strong>{{ result.crowdstrike.kill_chain | join(', ') }}<br>
                            {% endif %}
                            {% if result.crowdstrike.vulnerabilities | length > 0 %}
                                <strong>Vulnerabilities: </strong>{{ result.crowdstrike.vulnerabilities | join(', ') }}<br>
                            {% endif %}
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "webscout" in analysis_results.selected_engines %}
                    <td>
                        {% if result.webscout %}
                        {% if result.webscout.ip %}<strong>IP: </strong>{{ result.webscout.ip }}<br>{% endif %}
                        {% if result.webscout.risk_score %}<strong>Risk Score: </strong>{{ result.webscout.risk_score }}<br>{% endif %}
                        {% if result.webscout.country_name %}<strong>Country: </strong> <span class="country country-{{result.webscout.country_name | lower}}">{{result.webscout.country_name}}</span> <span class="fi fi-{{ result.webscout.country_code | lower }}"></span><br>{% endif %}
                        {% if result.webscout.hostnames %}<strong>Hostnames: </strong>{{ result.webscout.hostnames | join(', ') }}<br>{% endif %}
                        {% if result.webscout.asn %}
                            <span title="{% if result.webscout.description %}{{ result.webscout.description }}{% endif %}">
                                <strong>ASN: </strong>
                            {% if result.webscout.asn and result.webscout.asn != "" %}
                                {{ result.webscout.asn}}
                            {% endif %}
                            {% if result.webscout.as_org and result.webscout.as_org != "" %}
                                {{ result.webscout.as_org }}
                            {% endif %}
                            {% if (result.webscout.description and result.webscout.description != "") %}
                                ℹ️
                            {% endif %}
                            </span>
                            <br>
                        {% endif %}
                        {% if result.webscout.domains_on_ip %}<strong>Domains on IP: </strong>{{ result.webscout.domains_on_ip }}<br>{% endif %}
                        {% if result.webscout.network_type %}<strong>Type: </strong>{{ result.webscout.network_type }}<br>{% endif %}
                        {% if result.webscout.network_service %}<strong>Network Service: </strong>{{ result.webscout.network_service }}<br>{% endif %}
                        {% if result.webscout.network_service_region %}<strong>Network Service Region: </strong>{{ result.webscout.network_service_region }}<br>{% endif %}
                        {% if result.webscout.network_provider_services %}<strong>Services: </strong>{{ result.webscout.network_provider_services | join(', ') }}<br>{% endif %}
                        {% if result.webscout.behavior %}<strong>Behavior: </strong>{{ result.webscout.behavior | join(', ') }}<br>{% endif %}
                        {% if result.webscout.open_ports %}<strong>Open Ports: </strong>{{ result.webscout.open_ports | join(', ') }}{% endif %}
                        {% if result.webscout.is_proxy %}
                        <strong>Proxy: </strong>{{ result.webscout.is_proxy }}<br>
                        {% endif %}
                        {% if result.webscout.is_vpn %}
                        <strong>VPN: </strong>{{ result.webscout.is_vpn }}<br>
                        {% endif %}
                        {% if result.webscout.is_tor %}
                        <strong>Tor: </strong>{{ result.webscout.is_tor }}<br>
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "criminalip" in analysis_results.selected_engines %}
                    <td>
                    {% include "engine_layouts/criminalip_table.html" %}
                    </td>
                    {% endif %}
                    {% if "alienvault" in analysis_results.selected_engines %}
                    <td>
                    {% include "engine_layouts/alienvault_table.html" %}
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% elif analysis_results.results | length == 1 %}

        <div class="cards-container">
            <div class="cards-results-container">
                <div class="card">
                    <h3 title="{{ analysis_results.results[0].observable }}">{{
                        analysis_results.results[0].observable[:64] }}{% if analysis_results.results[0].observable |
                        length > 80 %}...{% endif %}</h3>
                    <p>{{ analysis_results.results[0].type }}</p>
                </div>
                {% if analysis_results.results[0].reverse_dns and analysis_results.results[0].reverse_dns.reverse_dns %}
                <div class="card">
                    <h3>DNS Lookup</h3>
                    <p>{{ analysis_results.results[0].reverse_dns.reverse_dns | join(', ') }}</p>
                </div>
                {% endif %}
                {% if analysis_results.results[0].virustotal %}
                <div class="card
                {% if analysis_results.results[0].virustotal and (analysis_results.results[0].virustotal.total_malicious > 10 or analysis_results.results[0].virustotal.community_score < -10) %}
                 high-detection" style="background-color: red;" {% elif analysis_results.results[0].virustotal and
                    analysis_results.results[0].virustotal.community_score > 100 %}
                    clean-detection" style="background-color: green;"
                    {% else %}
                    "
                    {% endif %}
                    >
                    <h3>VirusTotal</h3>
                    <p><strong>Ratio: </strong><a href="{{ analysis_results.results[0].virustotal.link }}"
                            target="_blank">{{ analysis_results.results[0].virustotal.detection_ratio }}</a></p>
                    <p><strong>Community: </strong>{{ analysis_results.results[0].virustotal.community_score }}</p>
                </div>
                {% endif %}
                {% if analysis_results.results[0].extension %}
                <div class="card">
                    <h3>Extension</h3>
                    {% if analysis_results.results[0].extension.url %}
                    <p><a href="{{ analysis_results.results[0].extension.url }}"
                            target="_blank">{{ analysis_results.results[0].extension.name }}</a></p>
                    {% else %}
                    <p>Not Found</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <div class="cards-results-container">
                {% if analysis_results.results[0].rdap %}
                <div class="card">
                    <h3>RDAP</h3>
                    <p><strong>Registrar: </strong><a href="{{ analysis_results.results[0].rdap.link }}"
                            target="_blank">{{ analysis_results.results[0].rdap.registrar }}</a></p>
                    {% if analysis_results.results[0].rdap.abuse_contact %}
                    <p><strong>Abuse contact: </strong><a
                            href="mailto:{{ analysis_results.results[0].rdap.abuse_contact }}?subject=Report of abuse concerning {{ analysis_results.results[0].observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ analysis_results.results[0].type }} {{ analysis_results.results[0].observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{
                            analysis_results.results[0].rdap.abuse_contact }}</a></p>
                    {% endif %}
                    {% if analysis_results.results[0].rdap.registrant %}
                    <p><strong>Registrant: </strong>{{ analysis_results.results[0].rdap.registrant }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].rdap.organization %}
                    <p><strong>Organization: </strong>{{ analysis_results.results[0].rdap.organization }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].rdap.registrant_email %}
                    <p><strong>Registrant email: </strong><a
                            href="mailto:{{ analysis_results.results[0].rdap.registrant_email }}?subject=Report of abuse concerning {{ analysis_results.results[0].observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ analysis_results.results[0].type }} {{ analysis_results.results[0].observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{
                            analysis_results.results[0].rdap.registrant_email }}</a></p>
                    {% endif %}
                    <p><strong>Creation: </strong>{{ analysis_results.results[0].rdap.creation_date }}</p>
                    <p><strong>Expiration: </strong>{{ analysis_results.results[0].rdap.expiration_date }}</p>
                    <p><strong>Updated: </strong>{{ analysis_results.results[0].rdap.update_date }}</p>
                    <p><strong>Name servers: </strong>{{ analysis_results.results[0].rdap.name_servers | join(', ') }}
                    </p>
                </div>
                {% endif %}
                {% if analysis_results.results[0].ipquery %}
                <div class="card
                {% if analysis_results.results[0].ipquery and (analysis_results.results[0].ipquery.is_proxy or analysis_results.results[0].ipquery.is_vpn or analysis_results.results[0].ipquery.is_tor) %}
                 warning-row" style="background-color: orange;" {% elif analysis_results.results[0].ipquery and
                    analysis_results.results[0].ipquery.risk_score> 50 %}
                    high-risk" style="background-color: red;"
                    {% else %}
                    "
                    {% endif %}
                    >
                    <h3>IPquery</h3>
                    <p><strong>IP: </strong><a href="{{ analysis_results.results[0].ipquery.link }}" target="_blank">{{
                            analysis_results.results[0].ipquery.ip }}</a></p>
                    <p><strong>Score: </strong>{{ analysis_results.results[0].ipquery.risk_score }}</p>
                    <p><strong>Geoloc: </strong>{{ analysis_results.results[0].ipquery.geolocation }}</p>
                    <p><strong>Country: </strong>{{ analysis_results.results[0].ipquery.country_name }} <span
                            class="fi fi-{{ analysis_results.results[0].ipquery.country_code | lower }}"></span></p>
                    <p><strong>ASN: </strong>{{ analysis_results.results[0].ipquery.asn }} {{
                        analysis_results.results[0].ipquery.isp }}</p>
                    {% if analysis_results.results[0].ipquery.is_proxy %}
                    <p><strong>Proxy: </strong>{{ analysis_results.results[0].ipquery.is_proxy }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].ipquery.is_vpn %}
                    <p><strong>VPN: </strong>{{ analysis_results.results[0].ipquery.is_vpn }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].ipquery.is_tor %}
                    <p><strong>Tor: </strong>{{ analysis_results.results[0].ipquery.is_tor }}</p>
                    {% endif %}
                    {% if not analysis_results.results[0].ipquery.is_tor and not
                    analysis_results.results[0].ipquery.is_vpn and not analysis_results.results[0].ipquery.is_proxy %}
                    <p><strong>Type: </strong>Not anonymous</p>
                    {% endif %}
                </div>
                {% endif %}
                {% if analysis_results.results[0].ipinfo %}
                <div class="card">
                    <h3>IPinfo</h3>
                    <p><strong>IP: </strong><a href="{{ analysis_results.results[0].ipinfo.link }}" target="_blank">{{
                            analysis_results.results[0].ipinfo.ip }}</a></p>
                    <p><strong>Geoloc: </strong>{{ analysis_results.results[0].ipinfo.geolocation }}</p>
                    <p><strong>Country: </strong>{{ analysis_results.results[0].ipinfo.country_name }} <span
                            class="fi fi-{{ analysis_results.results[0].ipinfo.country_code | lower }}"></span></p>
                    <p><strong>Hostname: </strong>{{ analysis_results.results[0].ipinfo.hostname }}</p>
                    <p><strong>ASN: </strong>{{ analysis_results.results[0].ipinfo.asn }}</p>
                </div>
                {% endif %}
                {% if analysis_results.results[0].abusix %}
                <div class="card">
                    <h3>Abusix</h3>
                    <p><strong>Abuse contact: </strong><a
                            href="mailto:{{ analysis_results.results[0].abusix.abuse }}?subject=Report of abuse concerning {{ analysis_results.results[0].observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ analysis_results.results[0].type }} {{ analysis_results.results[0].observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{
                            analysis_results.results[0].abusix.abuse }}</a></p>
                </div>
                {% endif %}
            </div>
            <div class="cards-results-container">
                {% if analysis_results.results[0].abuseipdb %}
                <div class="card{% if analysis_results.results[0].abuseipdb and analysis_results.results[0].abuseipdb.risk_score > 50 %} high-risk"
                    style="background-color: red;" {% else %}"{% endif %}>
                    <h3>AbuseIPDB</h3>
                    <p><strong>Reports: </strong><a href="{{ analysis_results.results[0].abuseipdb.link }}"
                            target="_blank">{{ analysis_results.results[0].abuseipdb.reports }}</a></p>
                    <p><strong>Risk: </strong>{{ analysis_results.results[0].abuseipdb.risk_score }}%</p>
                </div>
                {% endif %}
                {% if analysis_results.results[0].spur %}
                <div class="card{% if analysis_results.results[0].spur and analysis_results.results[0].spur.tunnels not in ['Not anonymous', 'Non applicable'] %} warning-row"
                    style="background-color: orange;" {% else %}"{% endif %}>
                    <h3>Spur.us</h3>
                    <p><a href="{{ analysis_results.results[0].spur.link }}" target="_blank">{{
                            analysis_results.results[0].spur.tunnels }}</a></p>
                </div>
                {% endif %}
                {% if analysis_results.results[0].webscout %}
                <div class="card
                {% if 'vpn' in analysis_results.results[0].webscout.network_provider_services | map('lower') or 'proxy' in analysis_results.results[0].webscout.network_provider_services | map('lower') or analysis_results.results[0].webscout.is_vpn or analysis_results.results[0].webscout.is_proxy or analysis_results.results[0].webscout.is_tor %}
                    warning-row" style="background-color: orange;"
                {% elif analysis_results.results[0].webscout.risk_score > 50 %}
                    high-risk" style="background-color: red;"
                {% else %}
                    "
                {% endif %}
                >
                    <h3>WebScout</h3>
                    {% if analysis_results.results[0].webscout.ip %}
                    <p><strong>IP: </strong>{{ analysis_results.results[0].webscout.ip }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.risk_score %}
                    <p><strong>Risk Score: </strong>{{ analysis_results.results[0].webscout.risk_score }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.country_name %}
                    <p><strong>Country: </strong>{{ analysis_results.results[0].webscout.country_name }} <span class="fi fi-{{ analysis_results.results[0].webscout.country_code | lower }}"></span></p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.hostnames %}
                    <p><strong>Hostnames: </strong>{{ analysis_results.results[0].webscout.hostnames | join(', ') }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.asn %}
                    <p>
                        <span title="{% if analysis_results.results[0].webscout.description %}{{ analysis_results.results[0].webscout.description }}{% endif %}">
                            <strong>ASN: </strong>
                        {% if analysis_results.results[0].webscout.asn and analysis_results.results[0].webscout.asn != "" %}
                            {{ analysis_results.results[0].webscout.asn }}
                        {% endif %}
                        {% if analysis_results.results[0].webscout.as_org and analysis_results.results[0].webscout.as_org != "" %}
                            {{ analysis_results.results[0].webscout.as_org }}
                        {% endif %}
                        {% if (analysis_results.results[0].webscout.description and analysis_results.results[0].webscout.description != "") %}
                            ℹ️
                        {% endif %}
                        </span>
                    </p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.domains_on_ip %}
                    <p><strong>Domains on IP: </strong>{{ analysis_results.results[0].webscout.domains_on_ip }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.network_type %}
                    <p><strong>Type: </strong>{{ analysis_results.results[0].webscout.network_type }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.network_service %}
                    <p><strong>Network Service: </strong>{{ analysis_results.results[0].webscout.network_service }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.network_service_region %}
                    <p><strong>Network Service Region: </strong>{{ analysis_results.results[0].webscout.network_service_region }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.network_provider_services %}
                    <p><strong>Services: </strong>{{ analysis_results.results[0].webscout.network_provider_services | join(', ') }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.behavior %}
                    <p><strong>Behavior: </strong>{{ analysis_results.results[0].webscout.behavior | join(', ') }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.open_ports %}
                    <p><strong>Open Ports: </strong>{{ analysis_results.results[0].webscout.open_ports | join(', ') }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.is_vpn %}
                    <p><strong>VPN: </strong>{{ analysis_results.results[0].webscout.is_vpn }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.is_proxy %}
                    <p><strong>Proxy: </strong>{{ analysis_results.results[0].webscout.is_proxy }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].webscout.is_tor %}
                    <p><strong>Tor: </strong>{{ analysis_results.results[0].webscout.is_tor }}</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <div class="cards-results-container">
                {% if analysis_results.results[0].urlscan %}
                <div class="card">
                    <h3>URLscan</h3>
                    <p><strong>Scan count: </strong><a href="{{ analysis_results.results[0].urlscan.link }}"
                            target="_blank">{{ analysis_results.results[0].urlscan.scan_count }}</a></p>
                    {% if analysis_results.results[0].urlscan.scan_count == 0 %}
                    <p>Not Found</p>
                    {% else %}
                    <p><strong>
                            {% if analysis_results.results[0].type in ["FQDN", "URL"] %}
                            Top domains:
                            {% else %}
                            Top related domains:
                            {% endif %}
                        </strong></p>
                    <ul>
                        {% for domain in analysis_results.results[0].urlscan.top_domains %}
                        <li>{{ domain.domain }} ({{ domain.count }})</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                {% endif %}
            </div>

            <div class="cards-results-container">
                {% if analysis_results.results[0].mde %}
                <div class="card">
                    <h3>Microsoft Defender for Endpoint</h3>
                    {% if analysis_results.results[0].mde.ipAddress %}
                    <p><strong>Devices: </strong><a href="{{ analysis_results.results[0].mde.link }}" target="_blank">{{
                            analysis_results.results[0].mde.orgPrevalence }}</a></p>
                    <p><strong>First seen: </strong>{{ analysis_results.results[0].mde.orgFirstSeen }}</p>
                    <p><strong>Last seen: </strong>{{ analysis_results.results[0].mde.orgLastSeen }}</p>
                    {% elif analysis_results.results[0].mde.sha1 %}
                    <p><strong>Devices: </strong><a href="{{ analysis_results.results[0].mde.link }}" target="_blank">{{
                            analysis_results.results[0].mde.organizationPrevalence }}</a></p>
                    <p><strong>First seen: </strong>{{ analysis_results.results[0].mde.orgFirstSeen }}</p>
                    <p><strong>Last seen: </strong>{{ analysis_results.results[0].mde.orgLastSeen }}</p>
                    <p><strong>Top filenames: </strong>{{ analysis_results.results[0].mde.topFileNames }}</p>
                    <p><strong>File product name: </strong>{{ analysis_results.results[0].mde.fileProductName }}</p>
                    <p><strong>File publisher: </strong>{{ analysis_results.results[0].mde.filePublisher }}</p>
                    <p><strong>Signer: </strong>{{ analysis_results.results[0].mde.signer }}</p>
                    <p><strong>Issuer: </strong>{{ analysis_results.results[0].mde.issuer }}</p>
                    <p><strong>IsValidCertificate: </strong>{{ analysis_results.results[0].mde.isValidCertificate }}</p>
                    <p><strong>Determination: </strong>{{ analysis_results.results[0].mde.determinationType }}</p>
                    <p><strong>Determination value: </strong>{{ analysis_results.results[0].mde.determinationValue }}
                    </p>
                    {% elif analysis_results.results[0].mde.host %}
                    <p><strong>Devices: </strong><a href="{{ analysis_results.results[0].mde.link }}" target="_blank">{{
                            analysis_results.results[0].mde.orgPrevalence }}</a></p>
                    <p><strong>First seen: </strong>{{ analysis_results.results[0].mde.orgFirstSeen }}</p>
                    <p><strong>Last seen: </strong>{{ analysis_results.results[0].mde.orgLastSeen }}</p>
                    {% endif %}
                </div>
                {% endif %}
                {% if analysis_results.results[0].crowdstrike %}
                <div class="card{% if analysis_results.results[0].crowdstrike.indicator_found and analysis_results.results[0].crowdstrike.malicious_confidence == 'high' %} high-risk" style="background-color: red;"{% else %}"{% endif %}>
                    <h3>CrowdStrike</h3>
                    <p><strong>Device Count: </strong>{{ analysis_results.results[0].crowdstrike.device_count }}</p>
                    <p><strong>Link: </strong><a href="{{ analysis_results.results[0].crowdstrike.link }}" target="_blank">See on CrowdStrike</a></p>
                    {% if analysis_results.results[0].crowdstrike.indicator_found %}
                        <p><strong>Published Date: </strong>{{ analysis_results.results[0].crowdstrike.published_date }}</p>
                        <p><strong>Last Updated: </strong>{{ analysis_results.results[0].crowdstrike.last_updated }}</p>
                        {% if analysis_results.results[0].crowdstrike.actors %}
                            <p><strong>Actors: </strong>{{ analysis_results.results[0].crowdstrike.actors | join(', ') }}</p>
                        {% endif %}
                        {% if analysis_results.results[0].crowdstrike.malicious_confidence %}
                            <p><strong>Malicious Confidence: </strong>{{ analysis_results.results[0].crowdstrike.malicious_confidence }}</p>
                        {% endif %}
                        {% if analysis_results.results[0].crowdstrike.threat_types %}
                            <p><strong>Threat Types: </strong>{{ analysis_results.results[0].crowdstrike.threat_types | join(', ') }}</p>
                        {% endif %}
                        {% if analysis_results.results[0].crowdstrike.malware_families %}
                        <p><strong>Malware Families: </strong>{{ analysis_results.results[0].crowdstrike.malware_families | join(', ') }}</p>
                        {% endif %}
                        {% if analysis_results.results[0].crowdstrike.kill_chain %}
                            <p><strong>Kill Chain: </strong>{{ analysis_results.results[0].crowdstrike.kill_chain | join(', ') }}</p>
                        {% endif %}
                        {% if analysis_results.results[0].crowdstrike.vulnerabilities | length > 0 %}
                            <p><strong>Vulnerabilities: </strong>{{ analysis_results.results[0].crowdstrike.vulnerabilities | join(', ') }}</p>
                        {% endif %}
                    {% endif %}
                </div>
                {% endif %}
                {% if analysis_results.results[0].threatfox %}
                <div class="card{% if analysis_results.results[0].threatfox and analysis_results.results[0].threatfox.count != 0 %} high-risk"
                    style="background-color: red;" {% else %}"{% endif %}>
                    <h3>ThreatFox</h3>
                    {% if analysis_results.results[0].threatfox.count != 0 %}
                    <p><strong>Count: </strong><a href="{{ analysis_results.results[0].threatfox.link }}"
                            target="_blank">{{ analysis_results.results[0].threatfox.count }}</a></p>
                    <p><strong>Malware: </strong>{{ analysis_results.results[0].threatfox.malware_printable | join(', ')
                        }}</p>
                    {% else %}
                    <p>Not Found</p>
                    {% endif %}
                </div>
                {% endif %}

                {% if analysis_results.results[0].phishtank %}
                <div class="card">
                    <h3>Phishtank</h3>
                    {% if analysis_results.results[0].phishtank.in_database == True and
                    analysis_results.results[0].phishtank.valid == True and
                    analysis_results.results[0].phishtank.verified == True %}
                    <p><a href="{{ analysis_results.results[0].phishtank.phish_detail_page }}" target="_blank">Found
                            (valid and verified)</a></p>
                    {% elif analysis_results.results[0].phishtank.in_database == True and
                    analysis_results.results[0].phishtank.valid == False %}
                    <p><a href="{{ analysis_results.results[0].phishtank.phish_detail_page }}" target="_blank">Found
                            (invalid)</a></p>
                    {% elif analysis_results.results[0].phishtank.in_database == True and
                    analysis_results.results[0].phishtank.verified == False %}
                    <p><a href="{{ analysis_results.results[0].phishtank.phish_detail_page }}" target="_blank">Found
                            (not verified)</a></p>
                    {% elif analysis_results.results[0].phishtank.in_database == False %}
                    <p>Not Found</p>
                    {% else %}
                    <p>Not applicable</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <div class="cards-results-container">
                {% if analysis_results.results[0].google_safe_browsing %}
                <div class="card">
                    <h3>Google Safe Browsing</h3>
                    <p><strong>Threat: </strong>{{ analysis_results.results[0].google_safe_browsing.threat_found }}</p>
                    <p><strong>Details: </strong>{{ analysis_results.results[0].google_safe_browsing.details }}</p>
                </div>
                {% endif %}
                {% if analysis_results.results[0].shodan %}
                <div class="card">
                    <h3>Shodan</h3>
                    <p><strong>Ports: </strong>{{ analysis_results.results[0].shodan.ports | join(', ') }}</p>
                    {% if analysis_results.results[0].shodan.tags | length > 0 %}
                    <p><strong>Tags: </strong>{{ analysis_results.results[0].shodan.tags | join(', ') }}</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <div class="cards-results-container">
                {% if analysis_results.results[0].google %}
                <div class="card">
                    <h3>Google</h3>
                    <p><strong>Search results: </strong></p>
                    {% if analysis_results.results[0].google.results | length > 0 %}
                    {% for search_result in analysis_results.results[0].google.results %}
                    <p><a href="{{ search_result.url }}" target="_blank" title="{{ search_result.description }}">{{
                            search_result.title }}</a></p>
                    {% endfor %}
                    {% else %}
                    <p>Not Found</p>
                    {% endif %}
                </div>
                {% endif %}
                {% if analysis_results.results[0].github %}
                <div class="card">
                    <h3>Github</h3>
                    <p><strong>Search results: </strong></p>
                    {% if analysis_results.results[0].github.results | length > 0 %}
                    {% for search_result in analysis_results.results[0].github.results %}
                    <p><a href="{{ search_result.url }}" target="_blank" title="{{ search_result.description }}">{{
                            search_result.title }}</a></p>
                    {% endfor %}
                    {% else %}
                    <p>Not Found</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <div class="cards-results-container">
                {% if analysis_results.results[0].ioc_one_html %}
                <div class="card">
                    <h3>Ioc.One (HTML)</h3>
                    <p><strong>Search results: </strong></p>
                    {% if analysis_results.results[0].ioc_one_html.results | length > 0 %}
                    {% for search_result in analysis_results.results[0].ioc_one_html.results %}
                    <p><a href="{{ search_result.source }}" target="_blank" title="{{ search_result.header }}">{{
                            search_result.title }}</a></p>
                    {% endfor %}
                    {% else %}
                    <p>Not Found</p>
                    {% endif %}
                </div>
                {% endif %}
                {% if analysis_results.results[0].ioc_one_pdf %}
                <div class="card">
                    <h3>Ioc.One (PDF)</h3>
                    <p><strong>Search results: </strong></p>
                    {% if analysis_results.results[0].ioc_one_pdf.results | length > 0 %}
                    {% for search_result in analysis_results.results[0].ioc_one_pdf.results %}
                    <p><a href="{{ search_result.source }}" target="_blank" title="{{ search_result.header }}">{{
                            search_result.title }}</a></p>
                    {% endfor %}
                    {% else %}
                    <p>Not Found</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <div class="cards-results-container">
                {% if analysis_results.results[0].opencti %}
                <div class="card{% if analysis_results.results[0].opencti.latest_indicator_link and not analysis_results.results[0].opencti.revoked %} warning-row" style="background-color: orange;"{% else %}"{% endif %}>
                    <h3>OpenCTI</h3>
                    <p><strong>Global count: </strong>{{ analysis_results.results[0].opencti.global_count }}</p>
                    <p><strong>Entity counts:</strong></p>
                    <ul>
                        {% for entity, count in analysis_results.results[0].opencti.entity_counts.items() %}
                        <li>{{ entity }}: {{ count }}</li>
                        {% endfor %}
                    </ul>
                    <p><strong>Search link: </strong><a href="{{ analysis_results.results[0].opencti.search_link }}"
                            target="_blank">See on OpenCTI</a></p>
                    <p><strong>Latest Entity Created At: </strong>{{ analysis_results.results[0].opencti.latest_created_at }}</p>
                    {% if analysis_results.results[0].opencti.latest_indicator_link %}
                    <p><strong>Latest Indicator Name: </strong>{{ analysis_results.results[0].opencti.latest_indicator_name }}</p>
                    <p><strong>Latest Indicator Link: </strong><a href="{{ analysis_results.results[0].opencti.latest_indicator_link }}" target="_blank">See Indicator</a></p>
                    <p><strong>OpenCTI Score: </strong>{{ analysis_results.results[0].opencti.x_opencti_score }} / 100</p>
                    <p><strong>Confidence: </strong>{{ analysis_results.results[0].opencti.confidence }}</p>
                    <p><strong>Revoked: </strong>{{ analysis_results.results[0].opencti.revoked }}</p>
                    <p><strong>Valid From: </strong>{{ analysis_results.results[0].opencti.valid_from }}</p>
                    <p><strong>Valid Until: </strong>{{ analysis_results.results[0].opencti.valid_until }}</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <div class="cards-results-container">
                {% if analysis_results.results[0].hudsonrock %}
                <div class="card">
                    <h3>Hudson Rock</h3>
                    {% if analysis_results.results[0].type == "Email" and analysis_results.results[0].hudsonrock.stealers %}
                    <p><strong>Compromised Computer Details:</strong></p>
                    {% for stealer in analysis_results.results[0].hudsonrock.stealers %}
                    {% if stealer.computer_name %}
                    <p><strong>Computer Name: </strong>{{ stealer.computer_name }}</p>
                    {% endif %}
                    {% if stealer.operating_system %}
                    <p><strong>Operating System: </strong>{{ stealer.operating_system }}</p>
                    {% endif %}
                    {% if stealer.date_compromised %}
                    <p><strong>Date Compromised: </strong>{{ stealer.date_compromised }}</p>
                    {% endif %}
                    {% if stealer.total_corporate_services %}
                    <p><strong>Total Corporate Services: </strong>{{ stealer.total_corporate_services }}</p>
                    {% endif %}
                    {% if stealer.total_user_services %}
                    <p><strong>Total User Services: </strong>{{ stealer.total_user_services }}</p>
                    {% endif %}
                    {% endfor %}
                    {% elif analysis_results.results[0].type == "URL" or analysis_results.results[0].type == "FQDN" and analysis_results.results[0].hudsonrock.total %}
                    {% if analysis_results.results[0].hudsonrock.total %}
                    <p><strong>Compromised domain details</strong></p>
                    <p><strong>Total: </strong>{{ analysis_results.results[0].hudsonrock.total }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.total and analysis_results.results[0].hudsonrock.totalStealers %}
                    <p><strong>Total Stealers: </strong>{{ analysis_results.results[0].hudsonrock.totalStealers }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.employees %}
                    <p><strong>Employees: </strong>{{ analysis_results.results[0].hudsonrock.employees }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.users %}
                    <p><strong>Users: </strong>{{ analysis_results.results[0].hudsonrock.users }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.third_parties %}
                    <p><strong>Third Parties: </strong>{{ analysis_results.results[0].hudsonrock.third_parties }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.totalUrls %}
                    <p><strong>Total URLs: </strong>{{ analysis_results.results[0].hudsonrock.totalUrls }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.last_employee_compromised %}
                    <p><strong>Last Employee Compromised: </strong>{{ analysis_results.results[0].hudsonrock.last_employee_compromised.split('T')[0] }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.last_user_compromised %}
                    <p><strong>Last User Compromised: </strong>{{ analysis_results.results[0].hudsonrock.last_user_compromised.split('T')[0] }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.is_shopify %}
                    <p><strong>Is Shopify: </strong>{{ analysis_results.results[0].hudsonrock.is_shopify }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.applications %}
                    <p><strong>Applications: </strong>{{ analysis_results.results[0].hudsonrock.applications | map(attribute='keyword') | join(', ') }}</p>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.stealerFamilies %}
                    <p><strong>Stealer Families: </strong></p>
                    <ul>
                        {% for family, count in analysis_results.results[0].hudsonrock.stealerFamilies.items() %}
                        <li>{{ family }}: {{ count }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.stats.employees_urls %}
                    <p><strong>Employee URLs: </strong></p>
                    <ul>
                        {% for url in analysis_results.results[0].hudsonrock.stats.employees_urls %}
                        {% if "••" not in url %}
                        <li><a href="{{ url }}" target="_blank">{{ url }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% if analysis_results.results[0].hudsonrock.stats.clients_urls %}
                    <p><strong>Client URLs: </strong></p>
                    <ul>
                        {% for url in analysis_results.results[0].hudsonrock.stats.clients_urls %}
                        {% if "••" not in url %}
                        <li><a href="{{ url }}" target="_blank">{{ url }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% else %}
                    <p>Not applicable</p>
                    {% endif %}
                </div>
                {% endif %}
                {% if analysis_results.results[0].criminalip %}
                {% include "engine_layouts/criminalip_card.html" %}
                {% endif %}
                {% if analysis_results.results[0].alienvault %}
                {% include "engine_layouts/alienvault_card.html" %}
                {% endif %}

            </div>
        </div>
        {% endif %}
        {% endif %}
    </div>
    </div>
    <div class="end-of-cards">

    </div>

    <script>
        $(document).ready(function () {
            $('#resultsTable').DataTable({
                // Enable column reordering
                colReorder: true,
                // Enable responsive
                responsive: true,
                // Disable search
                searching: false,
                // Disable paging
                paging: false,
                ordering: true,
                info: false,
                // show sorting icons in th
                orderCellsTop: true
            });
        });

        // remove cards-results-container container if empty
        function checkCardsBasicInfo() {
            document.querySelectorAll('.cards-results-container').forEach(container => {
                if (container.children.length === 0) {
                    container.style.display = 'none';
                }
            });
        }

        checkCardsBasicInfo();
    </script>

</body>
<footer class="footer">
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/history">History</a></li>
            <li><a href="/stats">Statistics</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="https://github.com/stanfrbd/cyberbro" target="_blank">GitHub</a></li>
        </ul>
    </nav>
</footer>

</html>
<script>
    const moonIcon = "https://img.icons8.com/ios-filled/50/ffffff/moon-symbol.png";
    const sunIcon = "https://img.icons8.com/ios-filled/50/ffffff/sun.png";

    function filterTable() {
        const searchInput = document.getElementById("searchInput").value.toLowerCase();
        const countryFilter = document.getElementById("countryFilter").value.toLowerCase();
        const riskFilter = document.getElementById("riskFilter").value.toLowerCase();
        const detectionFilter = document.getElementById("detectionFilter").value.toLowerCase();
        const typeFilter = document.getElementById("typeFilter").value.toLowerCase();
        const proxyVpnFilter = document.getElementById("proxyVpnFilter").value.toLowerCase();
        const table = document.getElementById("resultsTable");
        const tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            let td = tr[i].getElementsByTagName("td");
            let showRow = true;

            if (searchInput) {
                showRow = Array.from(td).some(cell => cell.innerText.toLowerCase().includes(searchInput));
            }

            if (showRow && countryFilter !== "all") {
                const countrySpan = tr[i].querySelector(".country");
                const country = countrySpan ? countrySpan.className.split("-")[1] : "";
                showRow = country === countryFilter;
            }

            if (showRow && riskFilter !== "all") {
                const riskClass = tr[i].classList.contains("high-risk") ? "high" : "low";
                showRow = riskClass === riskFilter;
            }

            if (showRow && detectionFilter !== "all") {
                const detectionClass = tr[i].classList.contains("high-detection") ? "high" : tr[i].classList.contains("clean-detection") ? "clean" : "low";
                showRow = detectionClass === detectionFilter;
            }

            if (showRow && typeFilter !== "all") {
                showRow = td[1].innerText.toLowerCase() === typeFilter;
            }

            // Spur or IP Quality Score
            if (showRow && proxyVpnFilter !== "all") {
                let anonymousResult = "";
                anonymousResult = tr[i].innerText.toLowerCase();
                showRow = anonymousResult.includes(proxyVpnFilter);
            }

            tr[i].style.display = showRow ? "" : "none";
        }
    }

    function clearFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("countryFilter").value = "all";
        document.getElementById("riskFilter").value = "all";
        document.getElementById("detectionFilter").value = "all";
        document.getElementById("typeFilter").value = "all";
        document.getElementById("proxyVpnFilter").value = "all";
        filterTable();
    }

    function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
        updateDarkModeIcon();
    }

    function updateDarkModeIcon() {
        const darkModeIcon = document.getElementById("darkModeIcon");
        if (document.body.classList.contains("dark-mode")) {
            darkModeIcon.src = sunIcon;
            darkModeIcon.alt = "Light Mode";
        } else {
            darkModeIcon.src = moonIcon;
            darkModeIcon.alt = "Dark Mode";
        }
    }

    function applyDarkMode() {
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark-mode");
        }
        updateDarkModeIcon();
    }

    applyDarkMode();
</script>
